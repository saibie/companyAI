{% extends 'corp/base.html' %}

{% block title %}Dashboard - AI Corp{% endblock %}

{% block content %}
    <div class="panel" style="display: flex; justify-content: space-between; align-items: center; padding: 10px 20px;">
        <div class="tooltip-container">
            <strong>üîå Ollama Status: {{ ollama_status }}</strong>
            <span class="tooltip-text">
                <strong>Available Models:</strong><br>
                <ul style="padding-left: 15px; margin: 5px 0;">
                {% for model in ollama_models %}
                    <li>{{ model.name }}</li>
                {% empty %}
                    <li>No models found.</li>
                {% endfor %}
                </ul>
            </span>
        </div>
        <div>
            <strong>üß† Agent Queue:</strong> {{ agent_queue_status }}
        </div>
    </div>

    <div class="dashboard-grid">
        <div class="col-left">
            <div class="panel">
                <h2>üë• Organizational Chart</h2>
            <div id="agent-list">
                {% include 'corp/partials/agent_list.html' %}
            </div>
            </div>
            
            <div class="panel">
                <h3>Hire New Agent</h3>
                <form hx-post="{% url 'corp:dashboard' %}" hx-target="#agent-list" hx-swap="innerHTML">
                {% csrf_token %}
                <input type="hidden" name="action" value="create_agent">
                    <input type="text" name="name" placeholder="Agent Name" required>
                    <input type="text" name="role" placeholder="Agent Role (e.g. Python Dev)" required>
                    <select name="manager">
                    <option value="">-- No Manager (Direct Report to You) --</option>
                    {% for agent in agents %}
                        <option value="{{ agent.id }}">{{ agent.name }} ({{ agent.role }})</option>
                    {% endfor %}
                </select>
                    <button type="submit" class="btn btn-primary">Hire Agent</button>
            </form>
        </div>
        </div>

        <div class="col-right">
            <div class="panel" style="border-left: 5px solid #1890ff;">
                <h2 style="color: #0050b3; display: flex; align-items: center; gap: 8px;">
                    üöÄ Development Roadmap
                    <span style="font-size: 0.5em; background: #eee; padding: 2px 6px; border-radius: 4px; color: #666; font-weight: normal;">
                        Shared To-Do List
                    </span>
                </h2>
                <div id="roadmap-list-container">
                    {% include 'corp/partials/roadmap_list.html' %}
                </div>
            </div>
            <div class="panel">
            <h2 style="color: #6c757d;">üìã Backlog / To-Do</h2>
                <ul class="clean-list">
                    {% for task in todo_tasks %}
                    <li class="list-item" style="background-color: #f8f9fa;">
                        <div style="display: flex; justify-content: space-between;">
                            <strong>{{ task.title }}</strong>
                            <span style="font-size:0.8em; color:#666;">{{ task.created_at|date:"m/d H:i" }}</span>
                            </div>
                        <div style="font-size: 0.9em; color: #666; margin-top: 5px;">{{ task.description|truncatechars:80 }}</div>
                        </li>
                    {% empty %}
                    <li style="color: #999; padding: 10px;">No pending tasks.</li>
                    {% endfor %}
                </ul>
            </div>
            
            <div class="panel" style="border-left: 5px solid #ffc107;">
                <h2 style="color: #d39e00;">üôã‚Äç‚ôÇÔ∏è Pending Questions</h2>
                <div id="question-list-container">
                    {% include 'corp/partials/question_list.html' %}
                </div>
            </div>
            
            <div class="panel" style="border-left: 5px solid #28a745;">
                <h2>‚úÖ Tasks Waiting Approval</h2>
                <div id="task-list-container">
                    {% include 'corp/partials/task_list.html' %}
                </div>
            </div>

            <div class="panel">
                <h3>Create New Task</h3>
                <form hx-post="{% url 'corp:dashboard' %}" hx-target="#task-list-container" hx-swap="innerHTML">
                    {% csrf_token %}
                    <input type="hidden" name="action" value="create_task">
                    <input type="text" name="title" placeholder="Task Title" required>
                    <textarea name="description" placeholder="Task Description" required rows="3"></textarea>
                    <select name="assignee" required>
                        <option value="">-- Assign to Agent --</option>
                        {% for agent in all_my_agents %}
                            <option value="{{ agent.id }}">{{ agent.name }} ({{ agent.role }})</option>
                        {% endfor %}
                    </select>
                    <button type="submit" class="btn btn-success" style="width: auto;">Create Task</button>
                </form>
            </div>
        </div>
    </div>
{% endblock %}