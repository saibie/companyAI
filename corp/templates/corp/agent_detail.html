{% extends 'corp/base.html' %}

{% block title %}{{ agent.name }} - Detail{% endblock %}

{% block content %}
    <a href="{% url 'corp:dashboard' %}" style="display:inline-block; margin-bottom:15px; text-decoration:none; color:#666;">
        &larr; Back to Dashboard
    </a>

    <div class="panel">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <h1>{{ agent.name }}</h1>
            <span class="role-badge" style="font-size: 1em; max-width: none;">{{ agent.role }}</span>
        </div>

        <div style="margin-top: 10px; color: #555;">
            <p><strong>Manager:</strong> {% if agent.manager %}{{ agent.manager.name }}{% else %}CEO (You){% endif %}</p>
            <p><strong>Status:</strong> {% if agent.is_active %}<span style="color:green">Active</span>{% else %}<span style="color:red">Inactive</span>{% endif %}</p>
            <p><strong>Permissions:</strong> 
                {% if agent.can_hire %}Hire{% endif %} 
                {% if agent.can_fire %}Fire{% endif %}
                {% if not agent.can_hire and not agent.can_fire %}None{% endif %}
            </p>
        </div>
    </div>

    <div class="dashboard-grid">
        <div class="panel" style="flex:1;">
            <h3>ğŸ“ Tasks Created</h3>
            <ul>
                {% for task in created_tasks %}
                    <li>{{ task.title }} ({{ task.status }})</li>
                {% empty %}
                    <li style="color:#999">No tasks created.</li>
                {% endfor %}
            </ul>
        </div>

        <div class="panel" style="flex:1;">
            <h3>ğŸ“¥ Tasks Assigned</h3>
            <ul>
                {% for task in assigned_tasks %}
                    <li>{{ task.title }} ({{ task.status }})</li>
                {% empty %}
                    <li style="color:#999">No tasks assigned.</li>
                {% endfor %}
            </ul>
        </div>
    </div>

        <div class="panel">
        <h3>ğŸ§  Memories</h3>
            <ul>
                {% for memory in memories %}
                <li style="margin-bottom: 5px;">
                    <strong>{{ memory.type|capfirst }}:</strong> {{ memory.content|truncatechars:100 }} 
                    <span style="color:#999; font-size:0.8em;">({{ memory.created_at|date:"Y-m-d" }})</span>
                </li>
                {% empty %}
                <li style="color:#999">No memories yet.</li>
                {% endfor %}
            </ul>
        </div>

    {% if agent.is_active %}
    <div class="panel" style="border: 1px solid #ffcccc; background-color: #fff5f5;">
        <h3 style="color: #dc3545; margin-top:0;">âš ï¸ Danger Zone</h3>
        <p style="font-size: 0.9em; color: #666;">
            Firing this agent will transfer all their subordinates to their manager (or you). This action cannot be easily undone.
        </p>
        <form method="post">
            {% csrf_token %}
            <input type="hidden" name="action" value="fire_agent">
            <button type="submit" class="btn btn-danger" onclick="return confirm('Are you absolutely sure you want to fire {{ agent.name }}?');">
                ğŸ”¥ Fire {{ agent.name }}
            </button>
        </form>
    </div>
    {% endif %}

{% endblock %}